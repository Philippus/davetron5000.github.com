
<!DOCTYPE html>
<html language="en"><head>
  <meta charset="utf-8">
  <title>My first iPhone App - Part 2 - naildrivin5.com - David Bryant Copeland's Website</title>
  <meta name="author" content="David Bryant Copeland">

  
  <meta name="description" content="

  
    My first iPhone App - Part 2
    
      June 27, 2010
    
  
  
    See Part 1 first

For the past several days I&#39;ve had the app on m...">
  

  
  <link rel="canonical" href="http://naildrivin5.com/blog/2010/06/27/iphone-app-part-2.html">
  <link href="/favicon.png" rel="icon">
  <link href="" rel="alternate" title="naildrivin5.com - David Bryant Copeland's Website" type="application/atom+xml">
  <link href="/css/styles.css" rel="stylesheet">
  <script src="https://use.typekit.net/ylm4zpa.js"></script>
  <script>try{Typekit.load({ async: true });}catch(e){}</script>
            
  <meta name="google-site-verification" content="h_yTpXa6N3ebHj8DYmgX4lIFGHBW1NtGMVHfXuu7i_4" />
</head>
<body>
  <header class="site-header pb2 mb2 center">
    <h1 class="uc ls2 f1"><a href="/">naildrivin5.com</a></h1>
    <h2 class="ls1"><small class="uc h4">Website of</small> David Bryant Copeland</h2>
    <nav>
      <ul>
        <li class="text-c w-1-3"><a class="ib w-100 button" href="/">Blog</a></li>
        <li class="text-c w-1-3"><a class="ib w-100 button" href="/bio">About</a></li>
        <li class="text-c w-1-3"><a class="ib w-100 button" href="/talks">Talks</a></li>
      </ul>
      <div style="clear: both"></div>
    </nav>
  </header>
  <main>
    <section>
      <div>
<article role="article" class="blog-post">
  <header class="border-bottom border-light">
    <h1>My first iPhone App - Part 2</h1>
    <h2 class="f5 ls2 fw-bold mtnone uc ib">
      June 27, 2010
    </h2>
  </header>
  <section class="blog-content">
    <p><em>See <a href="/blog/2010/06/23/iphone-app-part-1.html">Part 1</a> first</em></p>

<p>For the past several days I&#39;ve had the app on my phone and used it to enter in wines to see how the UI was working.  Yesterday, I integrated
Core Data (Apple&#39;s Object/Relational Mapper (ORM), for lack of a better description) so that I could actually <em>save</em> some data.  I discovered some nuances to using Core Data, as well as a refinement in the UI.</p>

<h2>UI</h2>

<p>Last night, I had both my girlfriend Amy and my good friend Clay (who is also reasonably into wine) play around with the &quot;new wine&quot; screen.  Neither have an iPhone, and there were a few obvious problems:</p>

<ul>
<li>They were very unaccustomed to the &quot;Done&quot; button being in the upper-right corner, as well as the &quot;slot-machine&quot; control</li>
<li>Both had trouble with the &quot;Wine Name&quot; concept</li>
<li>Both had trouble dismissing the keyboard</li>
<li>Clay thought he was entering search terms and not a new Wine</li>
</ul>

<p>Later that evening, I had a glass of wine at a bar and entered it into my app.  Up until this point, I was just typing in wines I knew about, so this was the first &quot;real use&quot; of the app in the field.  I quickly realized that the &quot;Wine Name&quot; concept, while important, was too vague and confusing to be the first field you enter.  Most wines are known by the vineyard and some don&#39;t even have proper names or appellations.  So, I swapped the fields and added some examples in the placeholder text:</p>

<p><img src="/images/wine_brain_new_wine_comparison.jpg" alt="Comparison"></p>

<p>I also added a title to indicate that this screen is for adding a new wine.  Finally, I used the <a href="http://stackoverflow.com/questions/804563/how-to-hide-the-keyboard-when-empty-area-is-touched-on-iphone">background button trick</a> along with some events on the rating and type controls to dismiss the keyboard if you tap anywhere outside of a text field.</p>

<p>This feels much cleaner and flows a bit better.  While varietal is probably the third most important thing (at least for New World wines), the slot-machine control would be awkwardly placed right below the vineyard/vintage text fields, so I left it where it was.</p>

<p>As to Clay and Amy&#39;s confusion over some idiomatic iPhone design choices, I&#39;m not worrying about them a whole lot; a typical iPhone user will understand what&#39;s going on (I hope :).</p>

<h2>Core Data</h2>

<p>Backing all this is Apple&#39;s Core Data, which grew out of the <a href="http://en.wikipedia.org/wiki/Enterprise_Objects_Framework">Enterprise Objects Framework</a> (and was, incidentally, my first exposure to an ORM way back in 1998), is the simplest and most idiomatic way to store and manage data on the iPhone.  As with Interface Builder, you create the model visually, using a simplistic data modelling tool.  I set up the bare bones of my data model and generated the classes.</p>

<p><img src="/images/wine_brain_data_model.jpg" alt="Data Model"></p>

<p>The first problem I ran into was in changing the model after the database had been created on the device.  Core Data doesn&#39;t migrate your model for you by default.  I ended up starting over with a &quot;versioned&quot; model and implementing their default migration.  This will probably work for simple changes, but for more complex changes, it looks like it&#39;s somewhat difficult to migrate the model.  An unfortunate reason to do some Big Design Up Front.</p>

<p>My next problem was initializing reference data.  In my case, I wanted the list of varietals as well as the list of wine types (e.g. &quot;red&quot;, &quot;white&quot;) to be in the database and managed by Core Data.  I ended up creating an array of the values inside the app and then checking the database for their existence, adding them if they were missing.  It&#39;s a bit cheesy, but I can extract the lists to plist files later.  It <em>did</em> give me a chance to play with Objective-C&#39;s blocks feature.  I needed to map my list of <code>Varietal</code> objects to a list of strings, so I could compare that list against my default list.  While <code>NSArray</code> doesn&#39;t provide a map function, it does provide the equivalent of Ruby&#39;s <code>each</code> or Scala&#39;s <code>foreach</code>.  In true Apple/Objective-C style, it&#39;s called <code>enumerateObjectsUsingBlock</code> :)</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="nl">arrayWithCapacity</span><span class="p">:[</span><span class="n">array</span> <span class="n">count</span><span class="p">]];</span>
<span class="p">[</span><span class="n">array</span> <span class="nl">enumerateObjectsUsingBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">obj</span><span class="p">,</span> <span class="bp">NSUInteger</span> <span class="n">i</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="o">*</span><span class="n">stop</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">strings</span> <span class="nl">addObject</span><span class="p">:[</span><span class="n">obj</span> <span class="nl">valueForKey</span><span class="p">:</span><span class="s">@&quot;name&quot;</span><span class="p">]];</span>
<span class="p">}];</span></code></pre></div>

<p>The <code>stop</code> pointer is an out-only variable that you set to YES to allow for an early exit from the loop.  I&#39;m glad they&#39;ve adopted this functional style; I forsee explicit loops becoming just as quaint as GOTOs in the near future.</p>

<p>One thing bugged me about this process, however.  I had these generated classes and it wasn&#39;t clear how to add my own methods to them without losing the code every time I re-generated my model.  Enter <a href="http://github.com/rentzsch/mogenerator">mogenerator</a>.  This provides a more sophisticated bit of code generation, givng you two classes for each model: one for machines (i.e. for Core Data to manage) and a subclass for people (to which I can add custom methods).  Perfect!  I wasn&#39;t able to incorporate it into XCode, but I&#39;m happy running in on the command line as needed for now.</p>

<h2>Random Bits</h2>

<p>I spent more time than I would&#39;ve liked tracking down a nasty bug where every attempt to convert a string to a number (for the wine vintage year) resulted in a <code>nil</code> number.  It turns out I was confused about when some object lifecycle methods were being called and my pointer to an <code>NSNumberFormatter</code> was, in fact, pointing to <code>nil</code>.  Unlike Java, where you&#39;d get a <code>NullPointerException</code>, or C, where you&#39;d get a core dump, it seems Objective-C just returns <code>nil</code> and doesn&#39;t even issue a warning.  Very strange.  Once I realized that, the solution was obvious.</p>

<p>I&#39;m still not 100% sure I&#39;m structuring my code properly, but Stack Overflow&#39;s stalwart iPhone SDK answerers have been <em>incredibly</em> helpful in pointing me in the right direction.</p>

<h2>Next Steps</h2>

<p>Now that I&#39;ve got the ability to save and retrieve data, the next step is to start looking to browsing, viewing, and editing the database.  I think the domain is restricted enough that I can use the iPhone&#39;s idiomatic drill-down table navigation to filter the database.</p>

<p>Continued in <a href="/blog/2010/06/29/iphone-app-part-3.html">Part 3</a>, <a href="/blog/2010/07/08/iphone-app-part-4.html">Part 4</a>, and <a href="/blog/2010/07/18/iphone-app-part-5.html">Part 5</a></p>

  </section>
</article>
</div>

    </section>
  </main>
  <footer class="center">
    <p class="f6">
      Copyright &copy; 2006-2015, by David Bryant Copeland, All Rights Reserved
  </footer>
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</body></html>
